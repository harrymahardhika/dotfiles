#!/bin/bash

set -e

echo "ðŸ”„ Starting system updates..."

if [ -f /etc/arch-release ]; then
    # For Arch-based systems
    echo "ðŸ“¦ Updating Arch packages..."
    sudo pacman -Syu --noconfirm

    if command -v yay &> /dev/null; then
        echo "ðŸ“¦ Updating AUR packages..."
        yay -Sua --noconfirm
    fi

    # Remove orphan packages only if they exist
    orphans=$(pacman -Qdtq)
    if [ -n "$orphans" ]; then
        echo "ðŸ—‘ï¸  Removing orphan packages..."
        sudo pacman -Rns --noconfirm $orphans
    fi

    echo "ðŸ§¹ Cleaning package cache..."
    sudo pacman -Sc --noconfirm
else
    # For Ubuntu/Pop!_OS-based systems
    echo "ðŸ“¦ Updating Ubuntu/Debian packages..."
    sudo apt update
    sudo apt upgrade -y
    sudo apt autopurge -y && sudo apt autoremove -y && sudo apt clean

    if command -v pacstall &> /dev/null; then
        echo "ðŸ“¦ Updating Pacstall..."
        pacstall -U -P
        pacstall -Up -P
    fi
fi

# Update Flatpak
if command -v flatpak &> /dev/null; then
    echo "ðŸ“¦ Updating Flatpak packages..."
    flatpak update -y
fi

# Update Snap
if command -v snap &> /dev/null; then
    echo "ðŸ“¦ Updating Snap packages..."
    sudo snap refresh
fi

# Update Composer
if command -v composer &> /dev/null; then
    echo "ðŸŽ¼ Updating Composer..."
    composer global self-update
    composer global update -vv --profile
fi

# Update npm global packages
if command -v npm &> /dev/null; then
    echo "ðŸ“¦ Updating npm global packages..."
    sudo npm-check -gui
fi

echo "âœ… All updates completed!"
